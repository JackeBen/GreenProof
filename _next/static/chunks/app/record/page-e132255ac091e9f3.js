(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[314],{2842:(e,t,a)=>{"use strict";a.d(t,{v:()=>s});var n=a(2115),r=a(1408);function s(){let[e,t]=(0,n.useState)(null),[a,s]=(0,n.useState)(null),[i,l]=(0,n.useState)(""),[o,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),p=async()=>{let e=window.ethereum;if(!e)return void alert("请安装 MetaMask");try{var a;let n=new r.k(e);await (null==(a=e.request)?void 0:a.call(e,{method:"eth_requestAccounts"}));let i=await n.getSigner(),o=await i.getAddress(),c=await n.getNetwork();t(n),s(i),l(o),u(Number(c.chainId)),d(!0)}catch(e){console.error("连接钱包失败:",e)}};return(0,n.useEffect)(()=>{var e,a;let n=window.ethereum;if(!n)return;let i=new r.k(n);t(i),(async()=>{try{var e,t;let a=await (null==(e=n.request)?void 0:e.call(n,{method:"eth_accounts"})),r=await (null==(t=n.request)?void 0:t.call(n,{method:"eth_chainId"})),o=r?parseInt(r,16):NaN;if(u(o),a&&a.length>0){let e=await i.getSigner();s(e),l(a[0]),d(!0)}}catch(e){}})();let o=async e=>{if(!e||0===e.length){d(!1),s(null),l("");return}try{let t=await i.getSigner();s(t),l(e[0]),d(!0)}catch(e){}},c=e=>{try{u(parseInt(e,16))}catch(e){u(null)}};return null==n||null==(e=n.on)||e.call(n,"accountsChanged",o),null==n||null==(a=n.on)||a.call(n,"chainChanged",c),()=>{try{var e,t;null==n||null==(e=n.removeListener)||e.call(n,"accountsChanged",o),null==n||null==(t=n.removeListener)||t.call(n,"chainChanged",c)}catch(e){}}},[]),{provider:e,signer:a,address:i,chainId:o,isConnected:c,connect:p,switchToSepolia:async()=>{var e,t,a;let n=window.ethereum;if(n)try{await (null==(e=n.request)?void 0:e.call(n,{method:"wallet_switchEthereumChain",params:[{chainId:"0xaa36a7"}]}))}catch(e){if((null==e?void 0:e.code)===4902||(null==e||null==(t=e.message)?void 0:t.includes("Unrecognized chain ID")))try{await (null==(a=n.request)?void 0:a.call(n,{method:"wallet_addEthereumChain",params:[{chainId:"0xaa36a7",chainName:"Sepolia",rpcUrls:["https://ethereum-sepolia-rpc.publicnode.com"],nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io"]}]}))}catch(e){}}}}}},5326:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var n=a(5155),r=a(2115),s=a(2619),i=a.n(s),l=a(2842),o=a(6212);function u(){let{isConnected:e,connect:t}=(0,l.v)(),{contract:a,fhevmInstance:s,address:u,fheStatus:c,fheError:d,chainId:p}=(0,o.X)(),[y,m]=(0,r.useState)(""),[h,g]=(0,r.useState)(""),[x,b]=(0,r.useState)(0),[f,v]=(0,r.useState)(""),[w,N]=(0,r.useState)(!1),[j,T]=(0,r.useState)(0),S={无车出行:{unit:"公里",factor:.21,hint:"每公里≈0.21kg CO₂（燃油车替代）"},节约用水:{unit:"升",factor:3e-4,hint:"每升用水全生命周期≈0.0003kg CO₂"},使用可再生能源:{unit:"kWh",factor:.6,hint:"每kWh 与火电对比≈0.6kg CO₂"},植树或环保活动:{unit:"棵",factor:21,hint:"每棵树年均吸收≈21kg CO₂（取典型值）"},垃圾分类:{unit:"千克",factor:.1,hint:"每千克分类处理≈0.1kg CO₂ 减排（粗估）"}}[y],C=S?Math.max(0,Math.round((j||0)*S.factor)):0,k=async()=>{if(!y||x<=0)return void v("⚠️ 请填写完整信息");if(!e)return void v("⚠️ 请先连接钱包");if(!a||!s)return void v((e?null==p||0xaa36a7===p?"loading"===c?"⚠️ 正在初始化 FHEVM...":"⚠️ FHEVM 实例不可用":"⚠️ 请切换到 Sepolia 网络":"⚠️ 请先连接钱包")+(d?" (".concat(d.message,")"):""));try{N(!0),v("\uD83D\uDD10 正在加密贡献值...");let e=s.createEncryptedInput(a.target,u),t=Math.max(0,Math.floor(Number(x)));e.add32(t),await new Promise(e=>setTimeout(e,100));let n=await e.encrypt();v("\uD83C\uDF0D 环保足迹正在上链...");let r=await a.recordAction(y,h||"",n.handles[0],n.inputProof);v("⏳ 等待交易确认... ".concat(r.hash.slice(0,10),"...")),await r.wait(),v("✅ 你的环保行为已永久记录在区块链上！"),setTimeout(()=>{m(""),g(""),b(0)},2e3)}catch(e){console.error("上链失败:",e),v("❌ 上链失败: ".concat(e.message||"未知错误"))}finally{N(!1)}};return(0,n.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-green-100",children:[(0,n.jsx)("nav",{className:"bg-white/80 backdrop-blur-md shadow-sm border-b border-green-200",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:(0,n.jsxs)(i(),{href:"/",className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-3xl",children:"\uD83C\uDF3F"}),(0,n.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent",children:"GreenProof"})]})})}),(0,n.jsxs)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:[e?(0,n.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 space-y-8",children:[(0,n.jsxs)("div",{className:"text-center space-y-2",children:[(0,n.jsx)("div",{className:"text-6xl animate-float",children:"\uD83C\uDF31"}),(0,n.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"记录环保行为"}),(0,n.jsx)("p",{className:"text-gray-600",children:"让你的环保贡献被永久铭记"})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-gray-700",children:"选择行为类型"}),(0,n.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{value:"垃圾分类",icon:"♻️",color:"from-blue-500 to-cyan-500"},{value:"无车出行",icon:"\uD83D\uDEB4",color:"from-green-500 to-emerald-500"},{value:"节约用水",icon:"\uD83D\uDCA7",color:"from-blue-400 to-blue-600"},{value:"使用可再生能源",icon:"\uD83D\uDD0B",color:"from-yellow-500 to-orange-500"},{value:"植树或环保活动",icon:"\uD83C\uDF33",color:"from-green-600 to-green-800"}].map(e=>(0,n.jsxs)("button",{onClick:()=>m(e.value),className:"p-4 rounded-xl border-2 transition-all duration-300 ".concat(y===e.value?"bg-gradient-to-r ".concat(e.color," text-white border-transparent shadow-lg scale-105"):"bg-white border-gray-200 hover:border-green-300 hover:shadow-md"),children:[(0,n.jsx)("div",{className:"text-3xl mb-2",children:e.icon}),(0,n.jsx)("div",{className:"text-sm font-medium ".concat(y===e.value?"text-white":"text-gray-700"),children:e.value})]},e.value))})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("label",{className:"block text-sm font-semibold text-gray-700",children:["行为描述 ",(0,n.jsx)("span",{className:"text-gray-400 font-normal",children:"(可选)"})]}),(0,n.jsx)("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"例如：今天骑自行车上班，减少碳排放...",className:"w-full p-4 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all outline-none resize-none",rows:3})]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-gray-700",children:"环保贡献估值"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"number",value:x||"",onChange:e=>b(Number(e.target.value)),placeholder:S?"直接填写估算的 CO₂（单位 kg），或使用下方快速估算":"输入贡献值（单位 kg CO₂）",className:"w-full p-4 pr-24 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all outline-none"}),(0,n.jsx)("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"kg CO₂"})]}),S&&(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 flex flex-col gap-3",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["快速估算 \xb7 ",S.hint]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("input",{type:"number",value:j||"",onChange:e=>T(Number(e.target.value)),placeholder:"输入".concat(S.unit),className:"w-40 p-3 border-2 border-gray-200 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none"}),(0,n.jsx)("span",{className:"text-gray-600",children:"→ 约"}),(0,n.jsxs)("span",{className:"px-3 py-2 bg-white rounded-lg border border-green-200 text-green-700 font-semibold",children:[C," kg CO₂"]}),(0,n.jsx)("button",{type:"button",onClick:()=>b(C),className:"ml-2 px-4 py-2 bg-green-600 text-white rounded-lg shadow hover:shadow-md transition",children:"应用到上方"})]}),(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"仅作粗略参考，实际减排取决于场景与统计口径。"})]})]}),(0,n.jsx)("button",{onClick:k,disabled:w,className:"w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white text-lg font-semibold rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300",children:w?(0,n.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("span",{className:"animate-spin",children:"\uD83D\uDD04"}),"上链中..."]}):"\uD83C\uDF0D 上链记录"}),f&&(0,n.jsx)("div",{className:"p-4 rounded-xl text-center font-medium ".concat(f.includes("✅")?"bg-green-100 text-green-800":f.includes("⚠️")?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"," animate-slide-up"),children:f}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)(i(),{href:"/",className:"text-green-600 hover:text-green-700 font-medium",children:"← 返回首页"})})]}):(0,n.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 text-center space-y-6",children:[(0,n.jsx)("div",{className:"text-6xl",children:"\uD83D\uDD17"}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"连接钱包"}),(0,n.jsx)("p",{className:"text-gray-600",children:"请先连接 MetaMask 钱包并切换到 Sepolia 测试网"}),(0,n.jsx)("button",{onClick:t,className:"px-8 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300",children:"连接 MetaMask"})]}),(0,n.jsx)("div",{className:"mt-8 text-center text-gray-500 text-sm animate-fade-in",style:{animationDelay:"0.5s"},children:"\uD83D\uDCA1 提示：你的贡献值将使用 FHEVM 加密存储，确保隐私安全"})]})]})}},6212:(e,t,a)=>{"use strict";a.d(t,{X:()=>u});var n=a(2115),r=a(8678),s=a(2842);async function i(){if(window.relayerSDK)return window.relayerSDK;await new Promise((e,t)=>{let a=document.createElement("script");a.src="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs",a.async=!0,a.type="text/javascript",a.onload=()=>{if(!window.relayerSDK||"function"!=typeof window.relayerSDK.createInstance)return void t(Error("relayerSDK UMD not available"));e()},a.onerror=()=>t(Error("Failed to load relayer SDK UMD")),document.head.appendChild(a)});let e=window.relayerSDK;if(!e)throw Error("relayerSDK UMD not available after load");return e}let l=JSON.parse('[{"inputs":[{"internalType":"address","name":"badgeAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"category","type":"string"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"ActionRecorded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"level","type":"uint8"}],"name":"BadgeMinted","type":"event"},{"inputs":[],"name":"BADGE_LV1_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"BADGE_LV2_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"badge","outputs":[{"internalType":"contract IGreenBadgeNFT","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"inc","type":"uint32"},{"internalType":"uint32","name":"capPlain","type":"uint32"}],"name":"cappedAccumulate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"limit","type":"uint256"}],"name":"getTopUsers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalActions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserActions","outputs":[{"components":[{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"category","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"euint32","name":"value","type":"bytes32"}],"internalType":"struct GreenProof.Action[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserEncryptedCount","outputs":[{"internalType":"euint32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserEncryptedSum","outputs":[{"internalType":"euint32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"grantAccess","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"grantTransientAccess","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"externalEuint32","name":"threshold","type":"bytes32"},{"internalType":"bytes","name":"proof","type":"bytes"}],"name":"isCountAtLeast","outputs":[{"internalType":"ebool","name":"","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"level","type":"uint8"}],"name":"mintBadge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"protocolId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"string","name":"category","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"externalEuint32","name":"inputValue32","type":"bytes32"},{"internalType":"bytes","name":"inputProof","type":"bytes"}],"name":"recordAction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userActionCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]'),o=JSON.parse('{"sepolia":{"address":"0x1E19d64C600724deC2a00bFA506d6190Df03AEb9","chainName":"sepolia"}}');function u(){let{provider:e,signer:t,address:a,chainId:u,isConnected:c}=(0,s.v)(),[d,p]=(0,n.useState)(null),[y,m]=(0,n.useState)(null),[h,g]=(0,n.useState)("idle"),[x,b]=(0,n.useState)(null);return(0,n.useEffect)(()=>{var e;if(!t)return void p(null);let a=null==o||null==(e=o.sepolia)?void 0:e.address;if(!a)return void p(null);p(new r.NZ(a,l,t))},[t]),(0,n.useEffect)(()=>{!async function(){if(c&&u){if(0xaa36a7!==u){g("error"),b(Error("请切换到 Sepolia 网络")),m(null);return}try{g("loading"),b(null);let t=await i();await t.initSDK();let a=window.ethereum||void 0,n=await t.createInstance({...t.SepoliaConfig,network:null!=a?a:e});m(n),g("ready")}catch(t){try{let t=await i();await t.initSDK();let a=window.ethereum||void 0,n=await t.createInstance({...t.SepoliaConfig,network:null!=a?a:e});m(n),g("ready")}catch(e){g("error"),b(e),m(null)}}}}()},[c,u,e]),{contract:d,fhevmInstance:y,provider:e,signer:t,address:a,isConnected:c,chainId:u,fheStatus:h,fheError:x}}},7739:(e,t,a)=>{Promise.resolve().then(a.bind(a,5326))}},e=>{e.O(0,[770,441,255,358],()=>e(e.s=7739)),_N_E=e.O()}]);