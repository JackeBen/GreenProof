(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58],{2842:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var a=n(2115),i=n(1408);function s(){let[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)(null),[r,l]=(0,a.useState)(""),[u,o]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),p=async()=>{let e=window.ethereum;if(!e)return void alert("请安装 MetaMask");try{var n;let a=new i.k(e);await (null==(n=e.request)?void 0:n.call(e,{method:"eth_requestAccounts"}));let r=await a.getSigner(),u=await r.getAddress(),d=await a.getNetwork();t(a),s(r),l(u),o(Number(d.chainId)),c(!0)}catch(e){console.error("连接钱包失败:",e)}};return(0,a.useEffect)(()=>{var e,n;let a=window.ethereum;if(!a)return;let r=new i.k(a);t(r),(async()=>{try{var e,t;let n=await (null==(e=a.request)?void 0:e.call(a,{method:"eth_accounts"})),i=await (null==(t=a.request)?void 0:t.call(a,{method:"eth_chainId"})),u=i?parseInt(i,16):NaN;if(o(u),n&&n.length>0){let e=await r.getSigner();s(e),l(n[0]),c(!0)}}catch(e){}})();let u=async e=>{if(!e||0===e.length){c(!1),s(null),l("");return}try{let t=await r.getSigner();s(t),l(e[0]),c(!0)}catch(e){}},d=e=>{try{o(parseInt(e,16))}catch(e){o(null)}};return null==a||null==(e=a.on)||e.call(a,"accountsChanged",u),null==a||null==(n=a.on)||n.call(a,"chainChanged",d),()=>{try{var e,t;null==a||null==(e=a.removeListener)||e.call(a,"accountsChanged",u),null==a||null==(t=a.removeListener)||t.call(a,"chainChanged",d)}catch(e){}}},[]),{provider:e,signer:n,address:r,chainId:u,isConnected:d,connect:p,switchToSepolia:async()=>{var e,t,n;let a=window.ethereum;if(a)try{await (null==(e=a.request)?void 0:e.call(a,{method:"wallet_switchEthereumChain",params:[{chainId:"0xaa36a7"}]}))}catch(e){if((null==e?void 0:e.code)===4902||(null==e||null==(t=e.message)?void 0:t.includes("Unrecognized chain ID")))try{await (null==(n=a.request)?void 0:n.call(a,{method:"wallet_addEthereumChain",params:[{chainId:"0xaa36a7",chainName:"Sepolia",rpcUrls:["https://ethereum-sepolia-rpc.publicnode.com"],nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io"]}]}))}catch(e){}}}}}},3126:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var a=n(5155),i=n(2115),s=n(2619),r=n.n(s),l=n(6212);function u(){let{contract:e}=(0,l.X)(),[t,n]=(0,i.useState)(!1),[s,u]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{if(e)try{n(!0);let t=await e.getTopUsers(20),a=[];for(let n of t)try{let t=await e.userActionCount(n),i=Number(t);i>0&&a.push({address:n,count:i})}catch(e){}a.sort((e,t)=>t.count-e.count),u(a.slice(0,10))}finally{n(!1)}})()},[e]);let o=(0,i.useMemo)(()=>s.map((e,t)=>({rank:t+1,address:"".concat(e.address.slice(0,6),"...").concat(e.address.slice(-4)),count:e.count,contribution:0,badge:0===t?"\uD83E\uDD47":1===t?"\uD83E\uDD48":2===t?"\uD83E\uDD49":""})),[s]);return(0,a.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-green-100",children:[(0,a.jsx)("nav",{className:"bg-white/80 backdrop-blur-md shadow-sm border-b border-green-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:(0,a.jsxs)(r(),{href:"/",className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83C\uDF3F"}),(0,a.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent",children:"GreenProof"})]})})}),(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-12 space-y-8",children:[(0,a.jsxs)("div",{className:"text-center space-y-2 animate-fade-in",children:[(0,a.jsx)("div",{className:"text-6xl mb-4 animate-float",children:"\uD83C\uDFC6"}),(0,a.jsx)("h2",{className:"text-4xl font-bold text-gray-800",children:"环保达人排行榜"}),(0,a.jsx)("p",{className:"text-gray-600",children:"致敬每一位地球守护者"})]}),(0,a.jsx)("div",{className:"space-y-4 animate-slide-up",style:{animationDelay:"0.2s"},children:(t?Array.from({length:5}).map((e,t)=>({rank:t+1,address:"加载中...",count:0,contribution:0,badge:""})):o).map((e,t)=>{let n=e.rank<=3;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 group ".concat(n?"bg-gradient-to-r from-yellow-50 via-white to-yellow-50 border-2 border-yellow-300":"bg-white/90 backdrop-blur-sm"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-6",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold ".concat(n?"text-transparent bg-gradient-to-r from-yellow-500 to-orange-500 bg-clip-text":"text-gray-400"),children:["#",e.rank]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.badge&&(0,a.jsx)("span",{className:"text-4xl",children:e.badge}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-mono font-semibold text-gray-800",children:e.address}),(0,a.jsx)("div",{className:"text-sm text-gray-500 flex gap-3 mt-1",children:(0,a.jsxs)("span",{children:["\uD83D\uDCCA ",e.count," 次"]})})]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:e.count}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"环保次数"})]}),n&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-2xl bg-gradient-to-r from-yellow-200/0 via-yellow-200/20 to-yellow-200/0 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"})]},t)})}),(0,a.jsx)("div",{className:"text-center text-gray-500 text-sm animate-fade-in",style:{animationDelay:"0.4s"},children:"\uD83D\uDCA1 数据每 10 分钟更新一次 | 基于链上真实记录"}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(r(),{href:"/",className:"text-green-600 hover:text-green-700 font-medium",children:"← 返回首页"})})]})]})}},6212:(e,t,n)=>{"use strict";n.d(t,{X:()=>o});var a=n(2115),i=n(8678),s=n(2842);async function r(){if(window.relayerSDK)return window.relayerSDK;await new Promise((e,t)=>{let n=document.createElement("script");n.src="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs",n.async=!0,n.type="text/javascript",n.onload=()=>{if(!window.relayerSDK||"function"!=typeof window.relayerSDK.createInstance)return void t(Error("relayerSDK UMD not available"));e()},n.onerror=()=>t(Error("Failed to load relayer SDK UMD")),document.head.appendChild(n)});let e=window.relayerSDK;if(!e)throw Error("relayerSDK UMD not available after load");return e}let l=JSON.parse('[{"inputs":[{"internalType":"address","name":"badgeAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"category","type":"string"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"ActionRecorded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"level","type":"uint8"}],"name":"BadgeMinted","type":"event"},{"inputs":[],"name":"BADGE_LV1_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"BADGE_LV2_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"badge","outputs":[{"internalType":"contract IGreenBadgeNFT","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"inc","type":"uint32"},{"internalType":"uint32","name":"capPlain","type":"uint32"}],"name":"cappedAccumulate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"limit","type":"uint256"}],"name":"getTopUsers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalActions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserActions","outputs":[{"components":[{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"category","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"euint32","name":"value","type":"bytes32"}],"internalType":"struct GreenProof.Action[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserEncryptedCount","outputs":[{"internalType":"euint32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserEncryptedSum","outputs":[{"internalType":"euint32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"grantAccess","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"grantTransientAccess","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"externalEuint32","name":"threshold","type":"bytes32"},{"internalType":"bytes","name":"proof","type":"bytes"}],"name":"isCountAtLeast","outputs":[{"internalType":"ebool","name":"","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"level","type":"uint8"}],"name":"mintBadge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"protocolId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"string","name":"category","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"externalEuint32","name":"inputValue32","type":"bytes32"},{"internalType":"bytes","name":"inputProof","type":"bytes"}],"name":"recordAction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userActionCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]'),u=JSON.parse('{"sepolia":{"address":"0x1E19d64C600724deC2a00bFA506d6190Df03AEb9","chainName":"sepolia"}}');function o(){let{provider:e,signer:t,address:n,chainId:o,isConnected:d}=(0,s.v)(),[c,p]=(0,a.useState)(null),[y,m]=(0,a.useState)(null),[h,x]=(0,a.useState)("idle"),[f,g]=(0,a.useState)(null);return(0,a.useEffect)(()=>{var e;if(!t)return void p(null);let n=null==u||null==(e=u.sepolia)?void 0:e.address;if(!n)return void p(null);p(new i.NZ(n,l,t))},[t]),(0,a.useEffect)(()=>{!async function(){if(d&&o){if(0xaa36a7!==o){x("error"),g(Error("请切换到 Sepolia 网络")),m(null);return}try{x("loading"),g(null);let t=await r();await t.initSDK();let n=window.ethereum||void 0,a=await t.createInstance({...t.SepoliaConfig,network:null!=n?n:e});m(a),x("ready")}catch(t){try{let t=await r();await t.initSDK();let n=window.ethereum||void 0,a=await t.createInstance({...t.SepoliaConfig,network:null!=n?n:e});m(a),x("ready")}catch(e){x("error"),g(e),m(null)}}}}()},[d,o,e]),{contract:c,fhevmInstance:y,provider:e,signer:t,address:n,isConnected:d,chainId:o,fheStatus:h,fheError:f}}},9565:(e,t,n)=>{Promise.resolve().then(n.bind(n,3126))}},e=>{e.O(0,[770,441,255,358],()=>e(e.s=9565)),_N_E=e.O()}]);