(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{1935:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var a=n(5155),i=n(2619),s=n.n(i),r=n(2115),l=n(8678),o=n(6212);let p=JSON.parse('[{"inputs":[{"internalType":"string","name":"baseURI","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"owner","type":"address"}],"name":"ERC721IncorrectOwner","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC721InsufficientApproval","type":"error"},{"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC721InvalidApprover","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"}],"name":"ERC721InvalidOperator","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"ERC721InvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC721InvalidReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC721InvalidSender","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC721NonexistentToken","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint8","name":"level","type":"uint8"}],"name":"hasLevel","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint8","name":"level","type":"uint8"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"minters","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"baseURI","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"bool","name":"allowed","type":"bool"}],"name":"setMinter","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"tokenLevel","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]');function d(){let{contract:e,signer:t,address:n}=(0,o.X)(),[i,d]=(0,r.useState)(0),[u,y]=(0,r.useState)({}),[c,m]=(0,r.useState)(!1),[b,f]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{if(e&&n)try{let t=await e.userActionCount(n);d(Number(t));let a=await e.badge();if(a){let t=e.runner,i=new l.NZ(a,p,t),[s,r,o]=await Promise.all([i.hasLevel(n,1),i.hasLevel(n,2),i.hasLevel(n,3)]);y({1:!!s,2:!!r,3:!!o})}}catch(e){}})()},[e,n]);let h=i>=1&&!u[1],w=i>=20&&!u[2],v=async t=>{if(e)try{m(!0),f("正在领取...");let a=await e.mintBadge(t);await a.wait(),f("领取成功");try{let t=await e.badge(),a=e.runner,i=new l.NZ(t,p,a),[s,r,o]=await Promise.all([i.hasLevel(n,1),i.hasLevel(n,2),i.hasLevel(n,3)]);y({1:!!s,2:!!r,3:!!o})}catch(e){}}catch(e){f("领取失败：".concat((null==e?void 0:e.message)||e))}finally{m(!1)}},g=[{level:1,name:"环保新芽",icon:"\uD83C\uDF31",condition:"完成 1 次环保记录",owned:!0===u[1],claimable:h,color:"from-green-400 to-green-600",glow:"shadow-green-500/50"},{level:2,name:"绿色践行者",icon:"\uD83C\uDF3F",condition:"完成 20 次环保记录",owned:!0===u[2],claimable:w,color:"from-emerald-400 to-emerald-600",glow:"shadow-emerald-500/50"},{level:3,name:"地球守护者",icon:"\uD83C\uDF0D",condition:"累计贡献值超过 100 kg",owned:!0===u[3],claimable:!1,color:"from-blue-400 to-blue-600",glow:"shadow-blue-500/50"}];return(0,a.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-green-100",children:[(0,a.jsx)("nav",{className:"bg-white/80 backdrop-blur-md shadow-sm border-b border-green-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:(0,a.jsxs)(s(),{href:"/",className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-3xl",children:"\uD83C\uDF3F"}),(0,a.jsx)("span",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent",children:"GreenProof"})]})})}),(0,a.jsxs)("div",{className:"max-w-5xl mx-auto px-6 py-12 space-y-12",children:[(0,a.jsxs)("div",{className:"text-center space-y-2 animate-fade-in",children:[(0,a.jsx)("div",{className:"text-6xl mb-4 animate-float",children:"\uD83C\uDF96️"}),(0,a.jsx)("h2",{className:"text-4xl font-bold text-gray-800",children:"环保徽章"}),(0,a.jsx)("p",{className:"text-gray-600",children:"记录你的环保成就"})]}),(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg p-8 animate-slide-up",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"徽章收集进度"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-green-600",children:[g.filter(e=>e.owned).length," / ",g.length]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"已解锁"})]})]}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-1000",style:{width:"".concat(g.filter(e=>e.owned).length/g.length*100,"%")}})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:g.map((e,t)=>(0,a.jsxs)("div",{className:"relative group animate-slide-up ".concat(e.owned||e.claimable?"":"grayscale opacity-60"),style:{animationDelay:"".concat(.1*t,"s")},children:[(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm rounded-3xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 ".concat(e.owned?"hover:scale-105 ".concat(e.glow):e.claimable?"hover:scale-105":""),children:[(0,a.jsxs)("div",{className:"relative mb-6",children:[(0,a.jsx)("div",{className:"text-8xl text-center animate-float ".concat(e.owned||e.claimable?"":"grayscale"),children:e.icon}),e.owned&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r ".concat(e.color," opacity-20 blur-3xl animate-pulse")}),e.owned&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 bg-gradient-to-r from-green-500 to-green-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"✓ 已解锁"}),!e.owned&&e.claimable&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"可领取"}),!e.owned&&!e.claimable&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,a.jsx)("div",{className:"bg-gray-900/50 backdrop-blur-sm text-white px-4 py-2 rounded-lg font-semibold text-sm",children:"\uD83D\uDD12 未解锁"})})]}),(0,a.jsxs)("div",{className:"text-center space-y-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold bg-gradient-to-r ".concat(e.color," bg-clip-text text-transparent"),children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-600 bg-gray-100 rounded-lg px-4 py-2",children:e.condition}),e.claimable&&!e.owned&&(0,a.jsx)("button",{className:"w-full mt-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm font-semibold rounded-lg hover:shadow-lg transition disabled:opacity-50",disabled:c,onClick:()=>v(e.level),children:"领取徽章"}),e.owned&&(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)("a",{href:"#",className:"inline-block px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm font-semibold rounded-lg hover:shadow-lg transition",children:"查看 NFT 详情"})})]})]}),e.owned&&(0,a.jsx)("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-r ".concat(e.color," opacity-0 group-hover:opacity-10 transition-opacity pointer-events-none blur-xl")})]},t))}),b&&(0,a.jsx)("div",{className:"text-center text-sm text-blue-700",children:b}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(s(),{href:"/",className:"text-green-600 hover:text-green-700 font-medium",children:"← 返回首页"})})]})]})}},2842:(e,t,n)=>{"use strict";n.d(t,{v:()=>s});var a=n(2115),i=n(1408);function s(){let[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)(null),[r,l]=(0,a.useState)(""),[o,p]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),y=async()=>{let e=window.ethereum;if(!e)return void alert("请安装 MetaMask");try{var n;let a=new i.k(e);await (null==(n=e.request)?void 0:n.call(e,{method:"eth_requestAccounts"}));let r=await a.getSigner(),o=await r.getAddress(),d=await a.getNetwork();t(a),s(r),l(o),p(Number(d.chainId)),u(!0)}catch(e){console.error("连接钱包失败:",e)}};return(0,a.useEffect)(()=>{var e,n;let a=window.ethereum;if(!a)return;let r=new i.k(a);t(r),(async()=>{try{var e,t;let n=await (null==(e=a.request)?void 0:e.call(a,{method:"eth_accounts"})),i=await (null==(t=a.request)?void 0:t.call(a,{method:"eth_chainId"})),o=i?parseInt(i,16):NaN;if(p(o),n&&n.length>0){let e=await r.getSigner();s(e),l(n[0]),u(!0)}}catch(e){}})();let o=async e=>{if(!e||0===e.length){u(!1),s(null),l("");return}try{let t=await r.getSigner();s(t),l(e[0]),u(!0)}catch(e){}},d=e=>{try{p(parseInt(e,16))}catch(e){p(null)}};return null==a||null==(e=a.on)||e.call(a,"accountsChanged",o),null==a||null==(n=a.on)||n.call(a,"chainChanged",d),()=>{try{var e,t;null==a||null==(e=a.removeListener)||e.call(a,"accountsChanged",o),null==a||null==(t=a.removeListener)||t.call(a,"chainChanged",d)}catch(e){}}},[]),{provider:e,signer:n,address:r,chainId:o,isConnected:d,connect:y,switchToSepolia:async()=>{var e,t,n;let a=window.ethereum;if(a)try{await (null==(e=a.request)?void 0:e.call(a,{method:"wallet_switchEthereumChain",params:[{chainId:"0xaa36a7"}]}))}catch(e){if((null==e?void 0:e.code)===4902||(null==e||null==(t=e.message)?void 0:t.includes("Unrecognized chain ID")))try{await (null==(n=a.request)?void 0:n.call(a,{method:"wallet_addEthereumChain",params:[{chainId:"0xaa36a7",chainName:"Sepolia",rpcUrls:["https://ethereum-sepolia-rpc.publicnode.com"],nativeCurrency:{name:"SepoliaETH",symbol:"ETH",decimals:18},blockExplorerUrls:["https://sepolia.etherscan.io"]}]}))}catch(e){}}}}}},6212:(e,t,n)=>{"use strict";n.d(t,{X:()=>p});var a=n(2115),i=n(8678),s=n(2842);async function r(){if(window.relayerSDK)return window.relayerSDK;await new Promise((e,t)=>{let n=document.createElement("script");n.src="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs",n.async=!0,n.type="text/javascript",n.onload=()=>{if(!window.relayerSDK||"function"!=typeof window.relayerSDK.createInstance)return void t(Error("relayerSDK UMD not available"));e()},n.onerror=()=>t(Error("Failed to load relayer SDK UMD")),document.head.appendChild(n)});let e=window.relayerSDK;if(!e)throw Error("relayerSDK UMD not available after load");return e}let l=JSON.parse('[{"inputs":[{"internalType":"address","name":"badgeAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"string","name":"category","type":"string"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"ActionRecorded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint8","name":"level","type":"uint8"}],"name":"BadgeMinted","type":"event"},{"inputs":[],"name":"BADGE_LV1_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"BADGE_LV2_COUNT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"badge","outputs":[{"internalType":"contract IGreenBadgeNFT","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"inc","type":"uint32"},{"internalType":"uint32","name":"capPlain","type":"uint32"}],"name":"cappedAccumulate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"limit","type":"uint256"}],"name":"getTopUsers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalActions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserActions","outputs":[{"components":[{"internalType":"uint256","name":"timestamp","type":"uint256"},{"internalType":"string","name":"category","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"euint32","name":"value","type":"bytes32"}],"internalType":"struct GreenProof.Action[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserEncryptedCount","outputs":[{"internalType":"euint32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserEncryptedSum","outputs":[{"internalType":"euint32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"grantAccess","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"grantTransientAccess","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"externalEuint32","name":"threshold","type":"bytes32"},{"internalType":"bytes","name":"proof","type":"bytes"}],"name":"isCountAtLeast","outputs":[{"internalType":"ebool","name":"","type":"bytes32"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint8","name":"level","type":"uint8"}],"name":"mintBadge","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"protocolId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"string","name":"category","type":"string"},{"internalType":"string","name":"description","type":"string"},{"internalType":"externalEuint32","name":"inputValue32","type":"bytes32"},{"internalType":"bytes","name":"inputProof","type":"bytes"}],"name":"recordAction","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userActionCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]'),o=JSON.parse('{"sepolia":{"address":"0x1E19d64C600724deC2a00bFA506d6190Df03AEb9","chainName":"sepolia"}}');function p(){let{provider:e,signer:t,address:n,chainId:p,isConnected:d}=(0,s.v)(),[u,y]=(0,a.useState)(null),[c,m]=(0,a.useState)(null),[b,f]=(0,a.useState)("idle"),[h,w]=(0,a.useState)(null);return(0,a.useEffect)(()=>{var e;if(!t)return void y(null);let n=null==o||null==(e=o.sepolia)?void 0:e.address;if(!n)return void y(null);y(new i.NZ(n,l,t))},[t]),(0,a.useEffect)(()=>{!async function(){if(d&&p){if(0xaa36a7!==p){f("error"),w(Error("请切换到 Sepolia 网络")),m(null);return}try{f("loading"),w(null);let t=await r();await t.initSDK();let n=window.ethereum||void 0,a=await t.createInstance({...t.SepoliaConfig,network:null!=n?n:e});m(a),f("ready")}catch(t){try{let t=await r();await t.initSDK();let n=window.ethereum||void 0,a=await t.createInstance({...t.SepoliaConfig,network:null!=n?n:e});m(a),f("ready")}catch(e){f("error"),w(e),m(null)}}}}()},[d,p,e]),{contract:u,fhevmInstance:c,provider:e,signer:t,address:n,isConnected:d,chainId:p,fheStatus:b,fheError:h}}},9664:(e,t,n)=>{Promise.resolve().then(n.bind(n,1935))}},e=>{e.O(0,[770,441,255,358],()=>e(e.s=9664)),_N_E=e.O()}]);